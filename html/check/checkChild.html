<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link rel="stylesheet" type="text/css" href="../../lib/css/reset.css" />
		<link href="../../lib/css/mui.css" rel="stylesheet" />
		<script src="../../lib/js/jquery1.9.1.min.js"></script>
		<script src="../../lib/js/mui.min.js"></script>
		<style type="text/css">
			ul,
			.mui-content {
				margin: 0;
				padding: 0;
			}

			.panelItem {
				top: -14px;
			}

			body {
				background: #FFFFFF;
			}

			.mui-content {
				height: 0;
			}

			.mui-tableItem {
				width: 100%;
				color: #595959;
				padding: 15px 10px;
			}

			.hrclass {
				padding: 0;
				margin: 0;
				border: 0.8px solid #F2F2F2;
			}

			.secondaryItem {
				color: #2E8AEA;
			}
		</style>
	</head>
	<body>
		<div class="mui-content">
			<ul class="mui-table-view panelItem">
			</ul>
		</div>
	</body>
	<script type="text/javascript" charset="utf-8">
		//关闭back、menu按键监听，这样侧滑主界面会自动获得back和memu的按键事件，仅在主界面处理按键逻辑即可；
		var level = [];
		var main = null;
		var detailId;
		var towanitemnameitem;
		var valueList = [];
		var value = ''
		mui.init({
			keyEventBind: {
				backbutton: false,
				menubutton: false
			}
		});
		mui.plusReady(function() {
			main = plus.webview.currentWebview().opener();
			var self = plus.webview.currentWebview();
			detailId = self.detailId;
		})
		var url = window.localStorage.getItem('url')
		var textTwoValue = window.localStorage.getItem('textTwoValue')
		window.addEventListener("changeCity", function(e) {
			level = e.detail.cityName
			valuetext = e.detail.value
			towanitemnameitem = e.detail.towanitemnameitem
			muiTable()
		});
		window.addEventListener("changeCitytimeone", function(e) {

		})
		window.addEventListener("xintian", function(e) {
			value = ''
		})

		function muiTable() {
			$('.mui-table-view').html('')
			
			mui.ajax(url + '/checklist/listOrder', {
				data: {
					detailId: detailId
				},
				type: 'get',
				dataType: "jsonp",
				jsonp: "jsoncallback",
				timeout: 10000,
				success: function(data) {
					
					var res = JSON.parse(data);
					var value = res.data.response.list;
					var orders = res.data.response.orders;
					var arrayItem = [];
					// var string='';
					if (orders.length == 0) {
						for (var index = 0; index < level.length; index++) {
							var secondaryItem = '';
							string = '</span><li class="mui-tableItem" onClick="pageItem(' + index + ')"><span class="secondary  ' +
								secondaryItem + '">' + level[index] +
								'</span></li><hr class="hrclass"/>'
							$('.mui-table-view').append(string)
							var stringText = ''
							$('#num' + index).html(stringText)
						}
					} else {
						for (var ordersNum = 0; ordersNum < orders.length; ordersNum++) {
							arrayItem.push(orders[ordersNum].itemId)
						}
						for (var index = 0; index < level.length; index++) {
							var secondaryItem = '';
							for (var num = 0; num < value.length; num++) {
								if (level[index] == value[num].two && valuetext == value[num].one) {
									if (arrayItem.indexOf(value[num].id) != -1) {
										secondaryItem = 'secondaryItem'
									}
								}
							}
							string = '</span><li class="mui-tableItem" onClick="pageItem(' + index + ')"><span class="secondary  ' +
								secondaryItem + '">' + level[index] +
								'</span></li><hr class="hrclass"/>'
							$('.mui-table-view').append(string)
							var stringText = ''
							$('#num' + index).html(stringText)
						}
					}
				},
				error: function() {}
			})
			for (var j = 0; j < $('.secondary').length; j++) {
				if ($('.secondary')[j].textContent.length > 8) {
					var textitam = $('.secondary')[j].textContent.substring(0, 8)
					var texthtml = textitam + '...'
					$('.secondary').eq(j).text(texthtml)
				}
			}
		}

		function pageItem(indexnum) {
		
			var main = plus.webview.getWebviewById("../check/check.html");
			mui.fire(main, 'changeCityitem', {
					// cityName: twoArr
				}),
				mui.openWindow({
					url: 'checkPageFather.html',
					id: 'checkPageFather.html',
					extras: {
						one: valuetext,
						detailId: detailId,
						two: level[indexnum],
						towanitemnameitem: towanitemnameitem
					}
				})
		}
		mui(".mui-content").on('tap', '.mui-table-view-cell', function() {
			// closeMenu();
			mui.openWindow({
				//              id:'checkPage.html',
				//              url:'checkPage.html'
			});
		})
	</script>
</html>
